

# 二、使用 H2O 流(H2O 的网络用户界面)

**机器学习** ( **ML** )不仅仅是代码。它包括从不同角度进行的大量观察。尽管实际的编码非常强大，但是在你编码的终端后面隐藏了很多信息。人类总是比文字更容易理解图片。类似地，尽管 ML 很复杂，但借助交互式用户界面**(**ui**)的帮助，它可以非常容易和有趣地实现。当学习困难的主题时，在单调的黑白像素化终端上使用彩色用户界面总是有利的。**

 ****H2O 流**是由 H2O.ai 团队开发的基于网络的 UI。这个接口与我们在 [*第一章*](B17298_01.xhtml#_idTextAnchor017) 、*了解 H2O 自动化基础知识*中了解到的后端是一样的。它只是一个包装在主 H2O 库上的 web UI，传递输入，触发后端服务器上的函数，并通过将结果显示给用户来读取结果。

在这一章中，我们将学习如何使用 H2O 流。我们将执行 ML 管道的所有典型步骤，我们在第 1 章[](B17298_01.xhtml#_idTextAnchor017)*、*了解 H2O AutoML 基础知识*的*了解 AutoML 和 H2O AutoML* 部分中了解了这些步骤，从读取数据集到使用训练好的模型进行预测。此外，我们将探索一些指标和模型细节，以帮助我们稍后轻松进入更高级的主题。本章是实践操作，我们将在创建 ML 管道时了解 H2O 流程的各个部分。*

 *本章结束时，你将能够导航和使用 H2O 流的各种功能。此外，您将能够训练您的 ML 模型并将其用于预测，而无需使用 H2O 流编写一行代码。

在本章中，我们将讨论以下主题:

*   了解 H2O 流的基础知识
*   在 H2O 流中使用数据函数
*   在 H2O 流程中使用模型训练函数
*   在 H2O 流中使用预测函数

# 技术要求

您将需要以下内容:

*   一个像样的网络浏览器(Chrome、Firefox 或 Edge)，您首选的网络浏览器的最新版本。

# 了解 H2O 流程的基础知识

H2O 流是一个开源的 web 界面，它帮助用户在一个叫做**流笔记本**或简称**流**的页面上执行代码、绘制图表和显示数据帧。

Jupyter 笔记本的用户会发现 H2O 流非常相似。您在单元格中编写可执行代码，当您执行该单元格时，代码的输出会显示在它的下方。然后，光标移动到下一个单元格。流最好的一点是，它可以很容易地在不同用户之间保存、导出和导入。这有助于许多数据科学家在各种利益相关者之间共享结果，因为他们只需要保存执行结果并共享流程。

在下面的小节中，我们将了解 H2O 流的基础知识。让我们从 H2O 流开始我们的旅程，首先，将它下载到我们的系统。

## 下载并启动 H2O 流量

为了运行 H2O 流，您将需要首先将H2O 流 **Java 归档** ( **JAR** )文件下载到您的系统上，然后在下载完成后运行JAR 文件。

您可以使用以下步骤下载并启动 H2O 流程:

1.  你可以在[https://H2O-release . S3 . Amazon AWS . com/H2O/master/latest . XHTML](https://h2o-release.s3.amazonaws.com/h2o/master/latest.xhtml)下载 H2O 流。
2.  下载完 ZIP 文件后，打开终端，在下载 ZIP 文件的文件夹中运行以下命令:

    ```
    unzip {name_of_the_h2o_zip_file}
    ```

3.  要运行 H2O 流，在最近解压缩的`h2o`文件的文件夹中运行以下命令:

    ```
    java -jar h2o.jar
    ```

这将在 [http://localhost:54321](http://localhost:54321) 上启动一个 H2O Web UI。

现在我们已经下载了并启动了 H2O 流，让我们简单地探索一下它，让了解它所提供的功能。

## 探索 H2O 流

H2O 流是一个功能非常密集的应用。它几乎拥有创建 ML 管道所需的所有特性。考虑到 ML 管道中涉及的各种步骤，H2O 流为所有这些步骤提供了大量的功能。这对很多人来说是难以承受的。因此，探索应用并一次关注一个应用的特定部分是值得的。

在下面的章节中，我们将详细了解所有这些部分；但是，有些函数可能太复杂，现阶段无法理解。我们将在接下来的章节中更好地理解它们。目前，我们将重点了解如何使用 H2O 流来创建 ML 管道。

因此，让我们从探索开始，首先，启动 H2O 流并在[http://localhost:54321](http://localhost:54321)URL 打开您的 web 浏览器。

以下屏幕截图显示了 H2O 流程 UI 的主页:

![Figure 2.1 – The main page of the H2O Flow UI

](img/B17298_02_001.jpg)

图 2.1–H2O 流程用户界面的主页

如果您看到略有不同，请不要惊慌。这可能是因为您安装的版本可能与本书中显示的版本不同。然而，UI 的基本设置应该是相似的。如你所见，有大量的交互选项可供选择。这一开始可能有点让人不知所措，所以让我们一点一点来。

在网页的最顶端，有各种 ML 对象操作，每一个都有自己的下拉函数列表。它们如下:

*   **流程**:该部分包含所有与流程笔记本相关的操作。
*   **单元格**:此部分包含与笔记本中各个单元格相关的所有操作。
*   **数据**:该部分包含所有与数据操作相关的操作。
*   **模型**:该部分包含所有与模型训练和算法相关的操作。
*   **评分**:该部分包含所有与评分和预测相关的操作。
*   **管理**:此部分包含所有管理操作，如下载日志。
*   **帮助**:此部分包含所有链接到 H2O 文档的其他详细信息。

一旦我们稍后开始创建 ML 管道，我们将一步一步地更详细地研究它们。

以下截图显示了 H2O 流程 UI 的各种 ML 函数操作:

![Figure 2.2 – The ML object operation toolbar

](img/B17298_02_002.jpg)

图 2.2–ML 对象操作工具栏

接下来是**流程名称**和**流程工具栏**设置。默认情况下，流名称将为**无标题流**。流程名称有助于识别整个流程，这样您就不会混淆不同的实验。**流程工具栏**部分是一个简单的工具栏，帮助您进行基本操作，如编辑和管理流程中的单元格。

下面的屏幕截图显示了主页上的流工具栏:

![Figure 2.3 – The Flow Name and flow toolbar sections

](img/B17298_02_003.jpg)

图 2.3–流程名称和流程工具栏部分

**单元格**是代码执行行，您可以逐个执行。它们也可以用来做注释、标题，甚至是减价文本。

这些工具如下所列。我们将从左至右开始:

*   **新建**:新建一个流笔记本。
*   **打开**:这将打开存储在您系统中的现有流程笔记本。
*   **保存**:保存你当前的流量。
*   **插入单元格**:在下方插入一个单元格。
*   **上移**:将当前高亮显示的单元格上移至上述单元格之上。
*   **下移**:将当前高亮显示的单元格移动到其下单元格的下方。
*   **剪切**:剪切单元格并存储在剪贴板上。
*   **复制**:复制当前高亮显示的单元格。
*   **粘贴**:将之前复制的单元格粘贴到当前高亮显示的单元格下方。
*   **清除单元格**:如果有单元格输出，则清除单元格输出。
*   **删除单元格**:删除整个单元格。
*   **运行并选择下方**:运行当前高亮显示的单元格，并在下方单元格处停止。
*   **运行**:运行当前高亮显示的单元格。
*   **运行所有**:从上到下逐一运行所有单元格。
*   **协助我**:这执行一个协助命令，通过显示基本 ML 命令的链接来帮助你。

在流程的右侧是帮助您管理工作流程的附加支持选项。你有**大纲**、**流**、**剪辑**、**助**。每个选项都有自己的功能详细信息栏。

以下屏幕截图显示了 H2O 流程 UI 的各种支持选项:

![Figure 2.4 – Support options

](img/B17298_02_004.jpg)

图 2.4–支持选项

**OUTLINE** 列显示了您执行的所有执行的列表。查看大纲有助于您快速检查创建 ML 管道时执行的所有步骤是否顺序正确，是否有任何重复，或者是否有任何不正确的步骤。

以下截图显示了**概要**支持选项部分:

![Figure 2.5 – OUTLINE

](img/B17298_02_005.jpg)

图 2.5–轮廓

**流程**栏显示您之前保存的所有流程。目前，您还没有，但是一旦您保存了一个流，它就会显示在这里，并带有一个打开它的快速链接。请注意，在 H2O 流程页面上，一次只能打开一个流程笔记本。如果您想要同时处理多个流，您可以通过打开另一个选项卡并在那里打开“流”记事本来实现。

以下截图显示了**流程**支持选项部分:

![Figure 2.6 – Saved flows

](img/B17298_02_006.jpg)

图 2.6–保存的流量

**剪辑**栏是你的剪贴板。如果有任何要执行的代码，您将在流程中运行多次，那么您可以编写一次，并通过选择单元格右侧的回形针图标将其保存到剪贴板。然后，您可以在需要时粘贴该单元格，而不需要在流程中搜索它。剪贴板还存储了一定数量的废纸篓。

以下截图显示了**夹**支持选项部分:

![Figure 2.7 – Clipboard

](img/B17298_02_007.jpg)

图 2.7–剪贴板

**帮助**栏显示各种资源，帮助用户使用 H2O 流。这包括快速入门视频、示例流程、一般使用示例以及官方文档的链接。请随意探索这些，以了解如何使用 H2O 流。

以下截图显示了**帮助**支持选项部分:

![Figure 2.8 – The Help section

](img/B17298_02_008.jpg)

图 2.8–帮助部分

回到页面顶部，让我们探索一下前两个下拉列表。它们简单易懂。

下面的屏幕截图显示了操作的第一个下拉列表，即流对象操作:

![Figure 2.9 – The Flow functions drop-down list

](img/B17298_02_009.jpg)

图 2.9–流函数下拉列表

**流程**操作下拉列表具有流程笔记本的基本功能。您可以创建一个新的流，打开一个现有的流，保存、复制、运行流中的所有单元，清除输出，以及下载流。下载流是非常有用的，因为您可以很容易地将您的 ML 工作从流转移到其他系统。

右边是**单元格**对象操作下拉列表(如图*图 2.10* )。这个下拉列表也很容易理解。它具有操纵流中各种单元的基本功能。通常，它的目标是流笔记本中高亮显示的单元格。您可以通过点击来更改高亮显示的单元格:

![Figure 2.10 – The Cell functions drop-down list

](img/B17298_02_010.jpg)

图 2.10–单元格功能下拉列表

我们将在开始 ML 管道工作时探索其他选项。

在本节中，我们了解了什么是 H2O 流，如何下载它，以及如何在本地启动它。此外，我们探索了H2O 流程用户界面的各个部分及其提供的各种功能。现在我们已经熟悉了我们的环境，让我们更深入地研究并创建我们的 ML 管道。我们先从流水线的第一部分开始，也就是手 凌数据。

# 在 H2O 流程中使用数据功能

ML 流水线总是从数据开始。当训练最高质量的模型时，您收集的数据量和数据质量起着非常关键的作用。如果数据的一部分与数据的另一部分没有关系，或者如果有许多对所述关系没有贡献的噪声数据，则模型的质量将相应地降低。因此，在训练任何模型之前，我们通常在将数据发送到模型训练之前对数据执行几个过程。H2O 流程在其**数据**操作下拉列表中为所有这些流程提供接口。

当我们使用 H2O 流构建 ML 管道时，我们将逐步理解各种数据操作和输出结果。

因此，让我们开始创建 ML 管道，首先，导入一个数据集。

## 导入数据集

我们将在本章中使用的数据集将是`Heart Failure Prediction`数据集。你可以在 https://www.kaggle.com/fedesoriano/heart-failure-prediction 的[找到心力衰竭预测数据集的细节。](https://www.kaggle.com/fedesoriano/heart-failure-prediction)

这是一个数据集，包含关于胆固醇、最大心率、胸痛和其他属性的个人的某些健康信息，这些属性是一个人是否可能经历心力衰竭的重要指标。

让我们了解一下数据集的内容:

*   **年龄**:患者的年龄，以年为单位
*   **性别**:患者的性别；m 代表男性，F 代表女性
*   **chest paint type**:
    *   这些类型如下所示:
        *   **TA** :典型心绞痛
        *   **ATA** :非典型心绞痛
        *   **午睡**:非心绞痛
        *   ASY:无症状
*   **静息血压**:静息血压单位为[毫米汞柱]
*   **胆固醇**:血清胆固醇[mm/dl]
*   **空腹血糖**:空腹血糖，大于 120 mg/dl 为 1，否则为 0
*   **静息心电图**:静息心电图结果
    *   这些类型如下所示:
        *   **正常**:正常
        *   **ST**:ST-T 波异常
        *   **LVH** :根据 Estes 标准显示可能或明确的左心室肥大
*   **MaxHR** :达到的最大心率值，介于 60 和 202 之间
*   **运动性心绞痛**:运动性心绞痛；y 代表是，N 代表否
*   **Oldpeak** : ST(在低压下测量的数值)
*   **ST_Slope** :运动 ST 段峰值的斜率
    *   这些类型如下:
        *   **向上**:向上倾斜
        *   **扁平**:扁平
        *   **向下**:向下倾斜
*   **心脏病**:输出类，1 表示心脏病，0 表示无心脏病

我们将训练一个模型，通过使用这个数据集来尝试预测一个具有某些属性的人是否有可能面临心力衰竭。执行以下步骤:

1.  首先，让我们从使用 H2O 流导入这个数据集开始。
2.  在 web UI 的最顶端，您可以看到**数据**对象操作下拉列表。
3.  单击它，web UI 应该会显示类似于以下屏幕截图的输出:

![Figure 2.11 – The Data object drop-down list

](img/B17298_02_011.jpg)

图 2.11–数据对象下拉列表

下拉列表向您显示了您可以执行的各种操作的列表，以及与您将使用的数据相关的操作。

这些功能如下所示:

*   **导入文件**:该操作导入存储在您系统中的文件。它们可以是以**逗号分隔值** ( **CSV** )格式或 Excel 格式编辑的任何可读文件。
*   **导入 SQL 表**:如果您使用 SQL 数据库存储任何表格数据，此操作允许您导入存储在您的**结构化查询语言** ( **SQL** )表中的数据。当您点击它时，系统会提示您将**连接 URL** 值输入到您的 SQL 数据库，同时输入其凭证、**表**名称、**列**名称，以及一个选择**获取模式**的选项，该模式可以是**分布式**或**单个**，如下面的截图所示:

![Figure 2.12 – Import SQL Table

](img/B17298_02_012.jpg)

图 2.12-导入 SQL 表

*   **上传文件**:该操作从您的系统上传一个文件并立即解析。
*   **分割帧**:该操作将已经被 H2O 流导入并解析的数据帧分割成多个帧，可以用于多个实验。
*   **合并帧**:该操作将多个帧合并为一帧。当你点击它的时候，会提示你选择右边和左边的框架以及它们各自的列。此外，您可以灵活地选择将哪个框架中的哪些行包含在合并中，如下面的屏幕截图所示:

![Figure 2.13 – Merge Frames

](img/B17298_02_013.jpg)

图 2.13–合并框架

*   **列出帧**:该操作列出了 H2O 当前导入并解析的所有帧。如果您想要在先前由您导入或拼接的不同数据集上运行管道，这将很有帮助。
*   **估算**:估算是用平均值替换数据集中缺失值的过程，这样就不会引入任何最小值、最大值甚至空值的偏差。此操作允许您根据自己的喜好替换框架中的这些值。

所以，首先，让我们导入`Heart Failure Prediction`数据集。

执行以下步骤:

1.  点击**数据**操作下拉列表。
2.  点击**导入文件…** 。您应该看到对流程中的单元执行的操作，如下面的屏幕截图所示:

![Figure 2.14 – Import Files

](img/B17298_02_014.jpg)

图 2.14-导入文件

您也可以通过在单元格中键入`importFiles`并按下 *Shift* + *Enter* 来直接运行相同的命令，而不是使用下拉列表。

1.  在搜索栏中，添加下载数据集的文件夹的位置。
2.  点击最右侧的搜索按钮。这将显示文件夹中的所有文件，您可以选择要导入的文件。
3.  选择`heart.csv`数据集，如下图所示:

![Figure 2.15 – Importing files with inputs

](img/B17298_02_015.jpg)

图 2.15–导入带有输入的文件

1.  选择文件后，点击**导入**按钮。然后，H2O 将导入数据集并向您显示输出，如下所示:

![Figure 2.16 – The imported files 

](img/B17298_02_016.jpg)

图 2.16–导入的文件

恭喜你！您现在已经成功地将您的数据集导入到 H2O 流中。下一步是将其解析成逻辑格式。让我们来了解一下什么是解析，以及如何在 H2O 流中进行解析。

## 解析数据集

**解析**是分析数据集中的信息字符串并将其加载到逻辑格式的过程，在本例中，是一个**十六进制**文件。十六进制文件是其内容以十六进制格式存储的文件。H2O 在内部使用这种文件类型进行数据帧操作，并维护数据集的元数据。

让我们通过执行以下步骤来解析新导入的数据集:

1.  导入数据集后，点击**解析这些文件…** 按钮，如图*图 2.16* 所示。

下面的屏幕截图显示了您应该期望的输出:

![Figure 2.17 – The dataset parsing inputs

](img/B17298_02_017.jpg)

图 2.17–数据集解析输入

1.  然后，会提示您输入`hex`文件。在解析过程中，您有以下配置可供选择:
    *   **Sources** :这个配置表示您将要解析的数据集的来源。
    *   **ID** :该配置表示数据集的 ID。您可以更改将要创建的十六进制文件的 ID。
    *   **解析器**:这个配置设置用于解析数据集的解析器。您将使用不同的解析器来解析不同类型的数据集。例如，如果您正在解析一个拼花文件，那么您将需要选择拼花文件解析器。在我们的例子中，我们正在解析一个 CSV 文件；因此，选择 **CSV** 解析器。您也可以将它设置为 **AUTO** ，H2O 会自动识别需要哪个解析器来解析指定的文件。
    *   **分隔符**:该配置用于指定分隔数据集中值的分隔符。让我们保留默认值，**，:‘004’**，这是一个非常常见的 CSV 分隔符值。
    *   **转义字符**:该配置用于指定数据集中使用的转义字符。让我们保留默认值。
    *   **列头**:该配置用于指定数据集的第一行是否包含列名。H2O 将使用该信息来处理第一个行，或者将其用作列信息，或者自动生成列名并将第一行用作数据值。此外，您可以将值设置为 **Auto** ，让 H2O 自行确定数据集的第一行是否包含列名。我们的数据集将第一行作为列名，所以我们选择**第一行包含列名**。
    *   **选项**:该配置包含如下附加操作:
        *   **启用单引号作为字段引用字符**:该选项启用单引号作为字段引用字符。
        *   **完成后删除**:该选项在成功解析导入的数据集后将其删除。让我们勾选这个选项，因为一旦我们成功解析了导入的数据集，我们就不再需要它了。
2.  在**解析配置**部分下面，有**编辑列名和类型**部分(参见*图 2.18* )。在解析数据集之前，H2O 阅读了数据集，并向您展示了列名和它们提取的信息类型的简短摘要。这为您提供了编辑列名和类型的选项，以防它错误地解释了某些内容，或者如果您希望将列名更改为其他内容。

以下屏幕截图显示了解析数据集时的列名和编辑列类型的选项:

![Figure 2.18 – Editing the column types

](img/B17298_02_018.jpg)

图 2.18–编辑列类型

现在，让我们简单了解一下列的类型，如前面的截图所示:

它们可以列举如下:

*   **数字**:表示该列中的值是数字。
*   **枚举**:表示该列中的值是**枚举类型** ( **枚举**)。枚举是一组指定的值，它们本质上是非数字的和有限的。
*   **Time** :表示列中的值为 datetime 数据类型值。
*   **UUID** :表示列中的值是**通用唯一标识符**(**uuid**)。
*   **字符串**:表示该列中的值为字符串值。
*   **无效**:这表示该列中的值无效，意味着该列中的值存在一些问题。
*   **未知**:这表示该列中的值是未知的，这意味着该列不包含任何值。

在训练过程中，H2O 根据数据帧的类型对数据帧的列进行不同的处理。有时，它会曲解列的值，并给列分配不正确的列类型。看一下数据集的列及其对应的类型。您可能会注意到，导入数据集后，我们的 **HeartDisease** 输出列的类型是 **Numeric** 。H2O 读取 1 和 0，并假设其类型为数字。但它实际上是一个**枚举**值，因为 1 表示心脏病，0 表示没有心脏病。两者之间没有数值。我们在解析数据集时总是需要小心。在我们开始对数据集进行模型训练之前，我们需要确保 H2O 正确地解释了数据集。H2O 流提供了一种简单的方法来在解析之前纠正这个问题。

接下来，让我们更正列类型:

1.  选择**心脏病**栏名称旁边的下拉列表，并将其设置为**枚举**。
2.  同样， **FastingBS** 会被设置为**数值**，但实际上根据其描述是一个**枚举**值。所以，我们把它设为 **Enum** 。
3.  既然我们已经更正了列类型并选择了正确的解析配置，那么让我们来解析数据集。点击输出底部的**解析**按钮。

下面的屏幕截图显示了解析后的输出:

![Figure 2.19 – Parsing the output

](img/B17298_02_019.jpg)

图 2.19-解析输出

现在，让我们观察从前面的截图中得到的输出:

*   运行时间:这个输出显示了从 H2O 开始解析数据集以来的运行时间。
*   **剩余时间**:这个输出显示了 H2O 完成数据集解析的预期剩余时间。
*   **Type** :这个输出显示了解析后的文件的类型。
*   **键**:这个输出显示了一个十六进制文件的链接，它是在成功解析后生成的。
*   **描述**:该输出显示当前正在执行的操作。
*   **状态**:该输出显示操作的当前状态。
*   **进度**:该输出显示操作的进度条。
*   **动作**:这个输出是一个按钮，显示成功解析数据集后生成的十六进制文件。

恭喜你！您已经成功解析了数据集并生成了十六进制文件。十六进制文件通常被称为**数据框架**。现在我们已经生成了一个数据帧，让我们来看看各种元数据和对数据帧执行的操作。

## 观察数据帧

数据帧是主数据对象，H2O 可以在其上执行多项数据操作。此外，H2O 就数据框架的内容提供了详细的见解和统计数据。当处理非常大的数据帧时，这些见解特别有用，因为很难识别数据行跨度从数千到数百万的任何列中是否有任何缺失或零。

因此，让我们观察刚刚解析的数据帧，并探索它的特性。您可以通过从我们在*图 2.19* 中看到的解析输出中执行以下任一操作来查看数据帧:

*   点击**键**行中的`heart.hex`超链接。
*   点击**动作**行中的**查看数据**按钮。

下面的屏幕截图显示了前面提到的操作的输出:

![Figure 2.20 – Viewing a dataframe

](img/B17298_02_020.jpg)

图 2.20–查看数据帧

输出显示数据帧的摘要。在研究**动作**部分的各种操作之前，首先，让我们研究一下下面显示的数据帧的元数据。

元数据由以下内容组成:

*   **行**:显示数据集中的行数
*   **列**:显示数据集中的列数
*   **压缩大小**:显示数据帧的总压缩大小

在元数据下面，有**列摘要**部分。在这里，您可以看到跨列拆分的数据帧内容的统计信息。

该摘要包含以下信息:

*   **标签**:该列显示数据帧的列名。
*   **类型**:该列显示该列的类型。
*   **缺失**:该列显示该列中缺失值的个数。
*   **零**:该列显示该列中零的个数。
*   **+Inf** :该列显示正无穷大值的个数。
*   **-Inf** :该列显示负无穷大值的个数。
*   **最小值**:该列显示该列中的最小值。
*   **最大值**:显示该列中的最大值。
*   **西格玛**:该列显示该列值的可变性。
*   **基数**:该列显示列中唯一值的数量。
*   **动作**:该列显示您可以在数据帧的列上执行的某些动作。这些操作主要包括将列转换成不同的类型。如果解析后 H2O 错误地读取了列类型，这对于纠正列类型非常有用。

您可能想知道为什么在**零**列中看到大量值，例如**性别**和**休息**。这是因为**编码**。当解析枚举列时，H2O 将枚举和字符串编码成从 0 到 1 的数字值，然后是 2，依此类推，依此类推。您也可以通过选择想要的编码过程来控制这个编码过程，例如**标签编码**或**一键编码**。我们将在第 5 章 、*理解 AutoML 算法*中更详细地讨论编码。

在**列摘要**部分之后，您将看到**块压缩摘要**部分，如以下截图所示:

![Figure 2.21 – The dataset’s CHUNK COMPRESSION SUMMARY section

](img/B17298_02_021.jpg)

图 2.21–数据集的块压缩摘要部分

当处理非常大的数据集时，如果以传统方式进行，从数据集中读取和写入数据会花费很长时间。因此，经常使用 Hadoop 文件系统、Spark 等系统，因为它们以分布式方式执行读写，比传统的连续方式更快。**分块**是一个过程，分布式文件系统如 Hadoop 将数据集分割成块，并在写入磁盘之前展平它们。H2O 在内部处理所有这些，因此用户不需要担心管理分布式读取或写入。**块压缩摘要**部分只是给出了关于块分布的附加信息。

在**块压缩概要**下面是**帧分配概要**部分，如下面的截图所示:

![Figure 2.22 – The dataset’s Frame Distribution Summary section

](img/B17298_02_022.jpg)

图 2.22–数据集的帧分布汇总部分

**帧分布汇总**部分给出了数据帧的总体统计信息。如果您已经导入了多个文件并将它们解析成一个数据帧，那么帧分布摘要将计算总大小、平均大小、最小大小、最大大小、每个数据集的块数量等等。

从*图 2.20* 中回顾数据帧，您可以看到列名被突出显示为链接。让我们点击最后一栏，**心脏病**。

以下截图将向您展示**心脏病**栏目的栏目摘要:

![Figure 2.23 – Column summary

](img/B17298_02_023.jpg)

图 2.23–列摘要

**列摘要**根据数据集中各个列的类型为您提供了更多的详细信息。

对于像**心脏病**这样的枚举，它向您显示该列的详细信息如下:

*   **特性**:此图显示了零值和非零值的百分比分布。
*   **域**:这个图显示了列的域，即一个值在总行数中重复的次数。

当你将鼠标悬停在图表上时，你会看到更多细节。请随意探索所有的列，并尝试了解它们的功能。

从*图 2.20* 回到数据帧，现在让我们看看**动作**部分。这包括可在数据帧上执行的某些动作。

这些行动包括以下内容:

*   **查看数据**:该动作显示数据框中的数据。
*   **分割**:该动作将数据帧按照指定的比例分割成指定的部分。
*   **构建模型**:这个动作开始在这个数据帧上构建模型。
*   **运行 AutoML** :该动作触发数据帧上的 AutoML。
*   **预测**:这个动作使用 dataframe 对一个已经训练好的模型进行预测，并得到结果。
*   **下载**:该动作将数据帧下载到系统。
*   **导出**:该动作将数据帧导出到系统中的指定路径。

尽管我们对触发 AutoML 感到兴奋，但还是让我们继续探索各种数据帧特性。

现在，让我们看看数据帧及其实际数据内容。为此，点击**动作**部分的**查看数据**按钮。

以下截图显示了**查看数据**按钮的输出:

![Figure 2.24 – The dataframe’s content view

](img/B17298_02_024.jpg)

图 2.24–数据框的内容视图

该函数显示数据集的实际内容。您可以向下滚动查看数据框的所有内容。如果您在数据帧上运行了任何操作，那么您将能够使用此操作查看数据帧内容的变化。

既然您已经探索并理解了各种数据帧操作和数据帧的元数据，让我们研究一下另一个有趣的数据帧操作，叫做 **Split** 。

## 分割数据帧

在我们发送用于模型训练的数据帧之前，我们需要一个带有预测值的样本数据帧。此样本可用于验证模型是否做出正确的预测，并测量模型的准确性和性能。我们可以通过保留一小部分数据帧供以后验证使用来做到这一点。这就是拆分功能发挥作用的地方。

**Split** 顾名思义，将数据集分割成若干部分，我们可以在以后使用它们进行不同的操作。数据集的分割考虑了比率。H2O 会根据您想要进行的分割数量和数据分布比率创建多个数据帧。

要分割数据框，点击**动作**部分的**分割**操作按钮上的。

下面的截图显示了点击**分割**按钮的输出:

![Figure 2.25 – Splitting a dataframe

](img/B17298_02_025.jpg)

图 2.25–分割数据帧

在前面的输出中，将提示您输入拆分配置，如下所示:

*   **框架**:此配置允许您选择想要分割的框架。
*   `training_dataframe`以 0.70 的比率
*   `validation_dataframe`以 0.20 的比率
*   `testing_dataframe`以 0.10 的比率

*   **种子**:这个配置让你选择随机点。Split 不会线性拆分数据帧。它随机分割数据帧的行。这是一件好事，因为它在分割的数据帧之间平均分配数据，从而消除了数据集行序列中可能存在的任何偏差。对于我们的演练，让我们将种子值设置为 5。

完成这些更改后，点击**创建**按钮。这将生成三个数据帧:**训练 _ 数据帧**、**验证 _ 数据帧**和**测试 _ 数据帧**。这三个帧将被保存在 H2O 的本地存储库中，也可以用于其他实验。

下图显示了**创建**操作的输出:

![Figure 2.26 – Split dataset results

](img/B17298_02_026.jpg)

图 2.26–分割数据集结果

所有三个数据帧都是独立的数据帧，具有与您在图 2.20 的*中看到的原始数据集相同的功能和选项。分割不会删除原始数据帧。它创建新的数据帧，并从原始数据帧中复制数据，然后根据选定的比率在数据帧之间分配这些数据。*

既然我们已经准备好了训练框架、验证框架和测试框架，我们就为模型训练管道的下一步，也就是模型训练，做好了准备。

因此，概括地说，在本节中，您了解了我们可以对 H2O 流中可用的数据集执行的各种数据操作，例如导入、解析、读取解析的数据帧以及分割它。

在下一节中，我们将重点关注模型训练，并使用 H2O AutoML 在我们在本标题中创建的数据框架上训练模型。

# 在 H2O 流程中使用模型训练功能

一旦你的数据集准备好了，模型训练管道的下一个步骤就是实际的训练部分。模型的训练可能会变得非常复杂，因为有许多配置决定了如何在数据集上训练模型。即使对于 AutoML 来说也是如此，在 AutoML 中，大多数超参数调整都是在幕后完成的。对于特定类型的数据，不仅有正确和错误的模型定型方法，而且一些配置值也会影响模型的性能。因此，在使用 AutoML 训练模型时，了解 H2O 必须提供的各种配置参数非常重要。在本节中，我们将重点了解这些参数是什么，以及它们在模型训练中的作用。

我们将了解如何使用 AutoML 逐步训练模型，使用我们之前创建的数据框架。

请注意，本节中有许多内容太复杂，现阶段无法理解。我们将在以后的章节中探讨其中的一些。目前，我们将只关注我们现在可以理解的特征，因为本章的目标是理解 H2O 流以及如何使用 AutoML 来训练使用 H2O 流的模型。

在下面的小节中，我们将了解模型训练操作，从了解 AutoML 训练配置参数开始。

## 了解 H2O 流中的 AutoML 参数

就你想如何训练你的模型而言，H2O 自动化是非常可配置的。尽管使用相同的 AutoML 技术，但通常每个行业都有特定的偏好或倾向，即希望如何根据需求训练模型。因此，尽管 AutoML 正在自动化大多数 ML 过程，但在 AutoML 如何训练其模型方面，仍需要一定程度的控制和灵活性。H2O 为其 AutoML 特性提供了广泛的配置能力。让我们在训练模型时探索它们。

有两种方法可以触发数据集上的 AutoML。它们列举如下:

*   点击数据帧输出的**动作**部分的**运行 AutoML** 按钮，如图*图 2.20* 所示。
*   在 web UI 最顶端的**模型**部分的下拉菜单中选择**运行 AutoML** ，如图 2.27 所示。

让我们选择第二个选项，这样我们就可以探索 web UI 页面顶部的**模型**操作部分。当您点击**型号**部分时，您应该会看到下拉列表，如下图所示:

![Figure 2.27 – The Model functions drop-down list

](img/B17298_02_027.jpg)

图 2.27–模型功能下拉列表

前面的下拉列表将模型操作分为三种类型，如下所示:

*   **运行 AutoML** :该操作通过提示用户输入配置值来启动 AutoML 过程以使用 AutoML 训练模型。
*   **运行特定模型**:该操作开始对您希望使用的特定 ML 算法进行模型训练；比如深度学习，K-means 聚类，随机森林等等。每个 ML 算法都有自己的一组参数，您必须指定这些参数才能开始训练模型。
*   **模型管理选项**:这些操作是基本操作，用于管理您可能在一段时间内训练过的各种模型。
    *   这些操作如下所示:
        *   **导入 MOJO 模型**:该操作导入 H2O **模型对象，优化** ( **MOJO** )之前由另一个 H2O 服务训练的模型，并以 MOJO 的形式导出到系统中。
        *   **列出所有模型**:此操作列出您的 H2O 服务训练的所有模型。这包括那些被其他心流笔记本训练过的人。
        *   **列出网格搜索结果**:网格搜索是一种技术，用于在训练模型时寻找最佳超参数，以获得最佳和最精确的性能。该操作列出了来自模型训练的所有网格搜索结果。
        *   **导入模型**:该操作将模型对象导入 H2O。
        *   **导出模型**:该操作将模型对象作为二进制文件或 MOJO 导出到系统中。

现在，让我们使用 AutoML 在数据集上训练我们的模型。

点击**运行 AutoML** 。如*图 2.27* 所示，您应该会看到一个输出，提示您输入各种配置参数来运行 AutoML。有大量的选项来配置您的 AutoML 训练。这些会极大地影响您的模型训练性能和最终得到训练的模型的质量。这些参数分为三类。让我们从基本参数开始，一个接一个地探索它们，并输入值以适应我们的模型训练要求。

### 基本参数

基本参数是关注所有模型训练操作所需的基本输入的参数。这些在所有的 ML 算法中是常见的，并且是不言自明的。

下面的屏幕截图显示了配置 AutoML 时需要输入的基本参数值:

![Figure 2.28 – The basic parameters of AutoML

](img/B17298_02_028.jpg)

图 2.28–AutoML 的基本参数

基本参数如下所示:

*   `training_frame`参数是我们在 H2O 流程部分的*中创建的`training_dataframe.hex`文件。*
*   `HeartDisease`列。
*   `validation_dataframe.hex`我们在上一节创建的文件。
*   **blending_frame** :该配置设置用于训练堆叠整体模型的数据帧。目前，我们可以忽略这一点，因为我们不会在本章中过多地探索堆叠系综。我们将在第五章[](B17298_05.xhtml#_idTextAnchor109)*、*了解 AutoML 算法*中更详细地探讨堆叠集成模型，因此我们将此留白。*
**   `nfolds`设为 0，则 AutoML 将从训练帧中生成排名。*   **project_name** :这个配置设置项目的名称。AutoML 会将多次运行的所有结果分组到该项目名称下的一个排名中。如果将该值留空，H2O 将自动为项目生成一个随机名称。*   **分布**:该配置用于指定 ML 算法使用的分布函数类型。支持指定分布函数类型的算法将使用它，而其他算法将使用它们的默认值。我们将在 [*第 5 章*](B17298_05.xhtml#_idTextAnchor109) 、*了解 AutoML 算法*中了解更多关于分布函数的内容。*

 *现在您已经了解了 AutoML 的基本参数，让我们了解一下高级参数。

### 高级参数

高级参数为使用 AutoML 的训练模型提供额外的配置。这些参数设置了某些默认值，因此不是强制性的。但是，它们确实提供了额外的配置，这些配置在训练模型时会改变 AutoML 的行为。

以下截图向您展示了 AutoML 高级参数的第一部分:

![Figure 2.29 – AutoML advanced parameters, part 1

](img/B17298_02_029.jpg)

图 2.29–AutoML 高级参数，第 1 部分

紧随其后的是高级参数的第二部分。向下滚动以查看剩余的参数，如下面的屏幕截图所示:

![Figure 2.30 – AutoML advanced parameters, part 2

](img/B17298_02_030.jpg)

图 2.30–AutoML 高级参数，第 2 部分

下面我们就来一一探究一下参数。高级参数如下所示:

*   **fold_column** :该参数在 N 重交叉验证时，以列值为基础创建其折叠。我们将在接下来的章节中学习更多关于交叉验证的知识。
*   **weights_column** :该参数为训练帧中的一列赋予权重，或者简单地说，为一列赋予优先级。我们将在后面的章节中更详细地探讨模型训练中的权重。
*   **ignored_columns** :此参数允许您从训练框架中选择训练模型时希望忽略的列。在我们的实验中，我们不会忽略任何列，所以我们将保留所有未选中的列。
*   **sort_metrics** :此参数选择将用于对 AutoML 训练的模型进行排序和排名的度量。选择**自动**将使用 **AUC** 度量进行二元分类，使用 **mean_per_class_error** 进行多项分类，使用**偏差**进行回归。为了简单起见，让我们将**均方误差** ( **MSE** )设置为排序度量，因为它更容易理解。我们将在第 6 章 、*了解 H2O 自动化排名和其他表现指标*中更详细地探讨这些指标。
*   `0`防止创建堆叠集合模型。我们将在接下来的章节中进一步探索堆叠集成模型和交叉验证。
*   **Balance_classes** :在模型训练中，最好是在输出类具有相等值分布的数据集上训练模型。这减轻了价值分配不均可能产生的偏见。此参数平衡输出类，使其数量相等。在我们的例子中，输出类是**心脏病**列。正如我们在**心脏病**列的摘要中看到的，在分布部分，我们有大约 410 个值为 0，508 个值为 1 ( *见图 2.23* )。因此，理想情况下，我们需要在训练模型之前平衡这些类。然而，为了保持事情的简单，我们将跳过职业的平衡，专注于理解基础知识。我们将在接下来的章节中进一步探讨职业平衡。
*   **exclude_algos** :该参数从 AutoML 训练中排除某些算法。对于我们的实验，我们要考虑所有的算法，所以让我们把这个值留空。
*   `-1`照现在这样。
*   **monoton _ constraints**:在某些情况下，如果非常强烈地认为特征之间的关系具有某种质量，则可以使用约束来提高模型的预测性能。该参数有助于设置这些约束。我们将在接下来的章节中对此进行更多的讨论。让我们把这个值留空。
*   `5`。
*   `10`，别的模型训练可能要花很长时间。
*   **max_runtime_secs** :该参数设置 H20 训练单个模型的最大时间。通常，数据集越大，模型的定型时间就越长。为模型训练设置非常小的运行时间不会给 AutoML 训练模型所需的时间。由于我们的数据集不是很大，我们将让 AutoML 花时间训练模型，这应该不会太长。
*   **max _ runtime _ sec _ per _ model**:该参数设置 AutoML 训练单个模型所花费的最大时间。模型训练不会花太长时间。所以，我们忽略这一点。
*   `0`将其禁用。
*   **stopping_metrics** :该指标用于提前停止。由于停止是禁用的，我们将忽略这一点。
*   **stopping_tolerance** :这是预期渐进式模型训练改进的相对容差，低于该容差，AutoML 应停止训练模型。由于停止是禁用的，我们将忽略这一点。

既然你已经了解了 AutoML 的基本参数是什么，那我们来查一下专家参数。

### 专家参数

专家参数是提供额外选项的参数，这些额外选项用有助于进一步实验的额外特征来补充 AutoML 训练结果。这些参数取决于您已经在*高级参数*部分选择的配置。

下面的屏幕截图显示了我们当前演练中可用的专家参数选项:

![Figure 2.31 – AutoML expert parameters

](img/B17298_02_031.jpg)

图 2.31–AutoML 专家参数

专家参数如下所示:

*   **keep _ cross _ validation _ predictions**:如果为训练启用了交叉验证，那么 H2O 会提供保存这些预测值的选项。
*   **keep _ cross _ validation _ models**:如果为训练启用了交叉验证，那么 H2O 提供了保存同样训练的模型的选项。
*   **keep _ cross _ validation _ fold _ assignments**:如果为训练启用了交叉验证，那么 H2O 提供了保存用于不同交叉验证的模型训练的折叠的选项。
*   **export_checkpoint_dir** :这是 H2O 存储生成模型的目录路径。

根据您在“基本”和“高级”参数中的选择，更多专家选项可用。目前，我们可以禁用所有专家参数，因为在本演练中我们不会过多关注它们。

一旦您设置了所有的参数值，现在剩下的唯一事情就是触发 AutoML 模型训练。

## 在 H2O 流程中使用 AutoML 训练和理解模型

模型训练是最复杂的之一，也是 ML 管道的重要部分。模型训练是通过学习特征和预期输出之间的关系来映射数学近似值的过程，同时努力使损失最小化。有多种方法可以做到这一点。系统执行该任务的方法被称为 ML 算法。AutoML 使用各种 ML 算法训练模型，并相互比较它们的性能，以根据 ML 问题找到具有最小误差度量值的模型。

首先，让我们了解如何在 H2O 流中使用 AutoML 来训练一个模型。

### 在 H2O 流程中使用 AutoML 训练模型

使用 AutoML 设置用于训练模型的参数值时，您需要仔细考虑。一旦选择了正确的输入，就可以触发 AutoML 模型训练。

你可以点击 **Run AutoML** 输出末尾的 **Build Models** 按钮来完成。

下面的屏幕截图显示了 AutoML 训练作业的进度:

![Figure 2.32 – The AutoML training is finished

](img/B17298_02_032.jpg)

图 2.32–AutoML 训练完成

训练模型应该需要一些时间。模型训练的结果存储在**排名**中。**键**部分的值是指向排名的链接(参见*图 2.32* )。

您可以通过两种方式查看排名。如下所列:

*   点击 AutoML 训练工作输出的**键**部分的排名链接。
*   点击 AutoML 训练作业输出的**查看**按钮。

在下面的截图中，你可以看到一个**排名**的样子:

![Figure 2.33 – AutoML Leaderboard

](img/B17298_02_033.jpg)

图 2.33–AutoML 排名

如果您按照前面的例子中所示的相同步骤，那么您应该看到相同的输出，尽管模型的 id 略有不同，因为它是随机生成的。排名显示了 AutoML 训练过的所有模型，并根据**排序标准**将它们从最好到最差排序。排序度量是模型质量的统计度量，用于比较不同模型的性能。此外，排名还提供了所有单个型号详情的链接。您可以单击其中的任何一个，以获得有关各个型号的更多信息。如果 AutoML 正在进行中并且当前正在训练模型，那么您也可以通过点击 **Monitor Live** 按钮来实时查看训练的进度。

既然您已经理解了如何使用 AutoML 训练一个模型，那么让我们深入 ML 模型的细节，并尝试理解它的各种特征。

### 理解 ML 模型

ML 模型可以被描述为包含数学方程的对象，该数学方程可以识别给定特征集的模式并预测潜在结果。这些 ML 模型构成了所有 ML 管道的中心组件，因为整个 ML 管道旨在创建和使用这些模型进行预测。因此，了解一个训练好的 ML 模型的各种细节是很重要的，以便证明它所做的预测是否准确以及准确到什么程度。

让我们点击排名上的最佳型号，了解更多详情。您应该会看到以下输出:

![Figure 2.34 – Model information

](img/B17298_02_034.jpg)

图 2.34–型号信息

正如你所看到的，H2O 提供了一个非常深入的模型细节。所有的细节都分门别类地放在各自的小节中。这里有大量的信息，因此，它可以是压倒性的。目前，我们将只关注重要的部分。

让我们逐一浏览一下重要且易于理解的细节:

*   **型号 ID** :这是型号的 ID。
*   **算法**:表示用于训练模型的算法。
*   **动作**:模型训练完成后，您可以对其执行以下动作:
    *   **刷新**:刷新内存中的模型。
    *   **预测**:这可以让你开始对这个模型进行预测。
    *   **下载 POJO** :以**普通旧 Java 对象** ( **POJO** )格式下载模型。
    *   **下载模型部署包**:下载 MOJO 格式的模型。
    *   **Export** :将模型作为文件或 MOJO 导出到系统中。
    *   **Inspect** : H2O 进入 Inspect 模式，在这里它检查模型对象，检索关于其模式和子模式的详细信息。
    *   **删除**:删除模型。
    *   **下载生成模型**:下载生成的模型 JAR 文件。

然后，您有一组子部分解释更多关于模型的元数据和性能。这些小节对于不同的模型略有不同，因为出于解释的目的，一些模型可能需要显示一些额外的元数据。

正如你所看到的，许多细节看起来本质上非常复杂，这是理所当然的。这是因为它们涉及到一点数据科学知识。不用担心；我们将在接下来的章节中探讨所有这些问题。

让我们看一下更简单的小节，这样我们就可以理解 ML 模型的各种元数据:

*   **模型参数**:模型参数只不过是我们传递给 AutoML 的输入参数，以及 AutoML 决定用来训练模型的一些输入。点击**显示所有参数**或**显示修改参数**按钮，您可以选择查看所有参数或仅查看修改后的参数。参数说明显示在每个参数的旁边。
*   **变量重要性**:变量重要性表示变量在进行预测时的重要性。最重要的变量是 ML 模型在进行预测时最依赖的变量。对非常重要的变量的任何改变都会极大地影响模型预测。

下面的屏幕截图向您展示了我们用来训练模型的数据框架中各种特征的重要程度:

![Figure 2.35 – Variable importances

](img/B17298_02_035.jpg)

图 2.35-可变重要性

*   **输出**:输出子部分表示AutoML 训练的基本输出值。显示的大部分详细信息是针对交叉验证结果的。

输出值如下所示:

*   **model_category** :该值表示模型的类别，表示它执行哪种预测。二项式表示它执行二项式分类，这意味着它预测值是 **1** 还是 **0** 。在我们的例子中， **1** 表示这个人可能面临心脏病，而 **0** 表示这个人不太可能面临心脏病。
*   **start_time** :该值表示开始模型训练的纪元时间。
*   **end_time** :该值表示结束模型训练的纪元时间。
*   **运行时间**:该值表示完成模型训练所用的历元总时间。
*   **default_threshold** :这是默认的阈值，超过该值，模型会将所有预测视为 **1** 。类似地，任何低于默认阈值的预测值都将是 **0** 。

下面的屏幕截图显示了 you 模型的输出子部分的详细信息:

![Figure 2.36 – Output of the model information

](img/B17298_02_036.jpg)

图 2.36–模型信息的输出

*   **Column_Types** :这一小节简要介绍数据帧中各列的类型。这些值的顺序与定型数据帧中的列顺序相同。

下面的屏幕截图显示了模型细节的 **column_types** 指标:

![Figure 2.37 – Column types

](img/B17298_02_037.jpg)

图 2.37–列类型

*   **Output-Training _ Metrics**:这一小节向您展示训练数据集用于预测时模型的指标。我们将在以后的章节中了解 ML 的各种度量标准。

下面的屏幕截图显示了模型详细信息的训练指标:

![Figure 2.38 – The model output’s training metrics

](img/B17298_02_038.jpg)

图 2.38–模型输出的训练指标

*   **Output-Validation _ Metrics**:与上一小节类似，这一小节向您展示了当验证数据集用于预测时模型的指标。

下面的屏幕截图显示了模型详细信息的训练指标:

![Figure 2.39 – The model output’s validation metrics

](img/B17298_02_039.jpg)

图 2.39–模型输出的验证指标

现在我们已经了解了模型细节的各个部分，让我们看看如何对这个新训练的模型执行预测。

# 在 H2O 流中使用预测功能

现在你终于有了一个经过训练的模型，我们可以对它进行预测。对训练模型的预测很简单。您只需要加载模型并传入您的数据集，其中包含您要进行预测的数据。H2O 将使用加载的模型并对数据集中的所有值进行预测。让我们使用之前创建的`prediction_dataframe.hex`数据框架进行预测。

我们将在以下小节中了解预测操作，首先了解如何进行预测。

## 利用 H2O 流进行预测

首先，让我们从开始探索 web UI 最顶端的**分数**操作的下拉列表。

您将看到评分操作列表，如下所示:

![Figure 2.40 – The Score functions drop-down menu

](img/B17298_02_040.jpg)

图 2.40–得分功能下拉菜单

前面的下拉菜单显示了您可以执行的各种评分操作的列表。

这些功能如下所示:

*   **预测**:使用训练好的模型进行预测。
*   **部分相关图**:这些图显示了变量对预测的影响。换句话说，它们向您展示了更改用于预测的数据中的某些变量如何影响预测响应。
*   **列出所有预测**:该功能列出所有已经做出的预测。

有两种方法可以开始在 H2O 流中进行预测。它们列举如下:

*   使用**分数**操作下拉菜单中的**预测**功能。
*   点击模型**动作**部分的**预测**按钮，如图*图 2.34* 所示。

这两种方法将给出相同的输出，如下面的屏幕截图所示:

![Figure 2.41 – Prediction

](img/B17298_02_041.jpg)

图 2.41–预测

点击 ML 模型的**预测**动作按钮，将**模型**参数设置为相应的模型 ID。但是，当点击**分数**操作下拉列表中的**预测**操作按钮时，您可以选择任何型号。

**预测**操作将提示您输入以下参数:

*   **名称**:您可以为预测结果命名，以便识别。如果您正在尝试不同的预测请求，并且需要快速引用您感兴趣的特定预测结果，这将非常方便。
*   **模型**:这是您希望使用进行预测的模型的 ID。由于我们选择了我们的**梯度提升器** ( **GBM** )模型的**预测**动作，这将不可编辑。
*   **框架**:这是您想要用来进行预测的数据框架。所以，让我们选择**预测 _ 数据集.十六进制**文件。
*   **计算叶节点分配**:为用于预测的数据帧中的每一行返回该行在模型的所有树中的叶位置。对于我们的演练，我们不需要这个，因此，我们可以不检查它。

一旦选择了合适的参数值，剩下唯一要做的就是点击**预测**按钮进行预测。

下面的截图显示了**预测**操作的输出:

![Figure 2.42 – The Prediction output

](img/B17298_02_042.jpg)

图 2.42–预测输出

恭喜你！你终于成功地对 AutoML 训练的模型做出了预测。让我们继续下一部分，我们将探索和理解我们刚刚得到的预测结果。

## 了解预测结果

预测是 ML 流水线的最后阶段。它是为创建 ML 管道的所有努力带来实际价值的部分。做预测很容易；但是，了解实际预测值以及它相对于输入值的意义非常重要。

预测结果不仅提供了预测值的详细信息，还提供了度量信息和某些元数据，如图*图 2.42* 所示。

以下屏幕截图显示了预测结果的预测输出子部分:

![Figure 2.43 – The prediction results

](img/B17298_02_043.jpg)

图 2.43–预测结果

这类似于我们在*图 2.38* 和*图 2.39* 中看到的模型细节的**输出验证和训练指标**。

在该子部分中，预测键旁边有预测帧链接。点击它会显示你的预测值的框架摘要。让我们这样做，以便我们可以得到一个很好的预测值。

下面的屏幕截图以数据框的形式显示了预测摘要的详细信息:

![Figure 2.44 – The prediction dataframe

](img/B17298_02_044.jpg)

图 2.44–预测数据框架

H2O 也将预测结果存储为数据帧。因此，它们具有我们在*在 H2O 流中使用数据函数*一节中讨论的相同特性。

**列汇总**部分表示预测数据帧中的三列。它们列举如下:

*   **预测**:该列为枚举类型，指示预测数据帧中输入行的预测值。
*   **P0** :该栏表示预测值为 0 的概率。
*   **P1** :该栏表示预测值为 1 的概率。

让我们查看数据，以便更好地理解其内容。点击预测数据帧输出的**动作**部分的**查看数据**按钮，可以查看数据帧的内容，如图*图 2.44* 所示。

以下屏幕截图显示了查看预测数据时的预期输出:

![Figure 2.45 – The content of the prediction dataframe

](img/B17298_02_045.jpg)

图 2.45–预测数据框架的内容

让我们回到预测输出的**预测**子部分，如图*图 2.43* 所示。让我们将预测结果与用作预测输入的数据框架结合起来。您可以通过点击**将预测与帧**结合按钮来实现。

下面的屏幕截图显示了该操作的输出:

![Figure 2.46 – The Combine predictions with frame result

](img/B17298_02_046.jpg)

图 2.46–组合预测和框架结果

点击**视图框**按钮显示组合框，也是一个数据框。让我们点击**查看框架**按钮查看框架的内容。

下面的截图显示了从帧的组合输出中得到的**视图帧**操作的输出:

![Figure 2.47 – The dataframe used for prediction combined with prediction results

](img/B17298_02_047.jpg)

图 2.47–用于预测和预测结果相结合的数据框架

选择组合预测输出的**动作**部分中的**查看数据**按钮，向您显示数据帧的完整内容，旁边是预测值。

以下屏幕截图显示了组合数据帧的内容:

![Figure 2.48 – The content of the combined dataframes

](img/B17298_02_048.jpg)

图 2.48–组合数据帧的内容

观察组合数据帧的内容，您会注意到现在可以很容易地比较预测值，如在**预测**列中所述，并将它们与同一行的**心脏病**列中的实际值进行比较。

恭喜你！您已经正式对一个模型进行了预测，您对该模型进行了训练并将结果合并到一个单一的数据框架中以进行比较，您可以与您的利益相关者共享该数据框架。因此，这总结了我们如何使用 H2O 流创建 ML 管道的演练。

# 总结

在本章中，我们了解了 H2O 流必须提供的各种功能。在熟悉了 web UI 之后，我们开始实现 ML 管道。我们导入并解析了心力衰竭预测数据集。我们了解了可以在数据帧上执行的各种操作，了解了数据帧的元数据和统计数据，并准备了数据集，以便稍后训练、验证和预测模型。

然后，我们使用 AutoML 在数据框架上训练模型。我们了解正确配置 AutoML 需要输入的各种参数。我们使用 AutoML 训练模型，并了解排名。然后，我们更深入地研究训练出来的模型的细节，尽力了解它们的特点。

一旦我们的模型被定型，我们就对其执行预测，然后通过将它与原始数据帧相结合来探索预测输出，以便我们可以比较预测值。

在下一章，我们将进一步探索各种数据操作。这将有助于我们了解在清理和转换数据帧方面需要采取哪些步骤，以及如何提高训练模型的质量。****